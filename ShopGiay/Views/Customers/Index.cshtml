@model IEnumerable<ShopGiay.Models.Mathang>

@{
    ViewData["Title"] = "Index";
}

<style>
    /* CSS Tùy chỉnh cho Card sản phẩm */
    .product-card {
        border: none;
        border-radius: 12px; /* Bo góc mềm mại */
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); /* Bóng đổ nhẹ */
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        overflow: hidden; /* Quan trọng để hình ảnh không tràn ra ngoài khi bo góc */
    }

        .product-card:hover {
            transform: translateY(-5px); /* Hiệu ứng nhấc nhẹ khi di chuột */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15); /* Bóng đổ mạnh hơn */
        }

    .card-img-top {
        border-bottom: 1px solid #eee;
        transition: transform 0.5s ease;
        object-fit: cover;
        height: 200px; /* Chiều cao cố định cho hình ảnh */
    }

    .product-card a:hover .card-img-top {
        transform: scale(1.05); /* Zoom ảnh nhẹ khi hover */
    }

    .sale-badge {
        z-index: 10;
        letter-spacing: 0.05em;
        padding: 0.35rem 0.75rem;
        font-weight: 700;
        border-radius: 0 0 0 10px; /* Chỉ bo góc dưới bên phải của badge */
    }

    .product-name {
        color: #1e81b0; /* Màu xanh nổi bật */
        font-size: 1.15rem;
        font-weight: 700;
        margin-bottom: 0.25rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .price-original {
        font-size: 0.9rem;
        color: #999;
    }

    .price-sale {
        font-size: 1.25rem;
        color: #e74c3c; /* Màu đỏ ấn tượng cho giá bán */
        font-weight: 900;
        margin-left: 5px;
    }
</style>

<h1 class="text-center display-5 fw-bold mb-4">
    <i class="bi bi-fire text-danger me-2"></i>Sản Phẩm Đang Hot<i class="bi bi-fire text-danger ms-2"></i>
</h1>

<p class="text-center text-secondary mb-5">Khám phá các mẫu giày mới nhất và ưu đãi đặc biệt chỉ có tại Shop MYiin!</p>


<div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center">
    @foreach (var item in Model)
    {
        <div class="col mb-5">
            <div class="card h-100 product-card">

                <!-- Sale badge - Giảm giá chỉ hiển thị nếu có chênh lệch giá -->
                @if (item.GiaGoc.HasValue && item.GiaGoc > item.GiaBan)
                {
                    <div class="badge bg-danger text-white position-absolute sale-badge" style="top: 0; right: 0;">
                        SALE
                    </div>
                }

                <!-- Product image -->
                <a asp-action="Details" asp-route-id="@item.MaMh" style="display: block; overflow: hidden;">
                    <img class="card-img-top" src="images/products/@Html.DisplayFor(modelItem => item.HinhAnh)" alt="Hình ảnh @Html.DisplayFor(modelItem => item.Ten)" />
                </a>

                <!-- Product details -->
                <div class="card-body p-4">
                    <div class="text-center">
                        <!-- Product name -->
                        <a asp-action="Details" asp-route-id="@item.MaMh" class="text-decoration-none">
                            <h5 class="product-name" title="@Html.DisplayFor(modelItem => item.Ten)">@Html.DisplayFor(modelItem => item.Ten)</h5>
                        </a>

                        <!-- Product reviews (Điểm đánh giá động từ database) -->
                        @{
                            var danhGiaDict = ViewBag.DanhGia as Dictionary<int, dynamic>;
                            double diemTrungBinh = 0;
                            int soLuongDanhGia = 0;

                            if (danhGiaDict != null && danhGiaDict.ContainsKey(item.MaMh))
                            {
                                diemTrungBinh = Math.Round(danhGiaDict[item.MaMh].DiemTrungBinh, 1);
                                soLuongDanhGia = danhGiaDict[item.MaMh].SoLuongDanhGia;
                            }

                            // Tính số sao đầy và sao rỗng
                            int soSaoDau = (int)Math.Floor(diemTrungBinh);
                            bool coSaoNua = (diemTrungBinh - soSaoDau) >= 0.5;
                            int soSaoRong = 5 - soSaoDau - (coSaoNua ? 1 : 0);
                        }

                        <div class="d-flex justify-content-center align-items-center small text-warning mb-2">
                            @* Hiển thị sao đầy *@
                            @for (int i = 0; i < soSaoDau; i++)
                            {
                                <div class="bi-star-fill"></div>
                            }

                            @* Hiển thị sao nửa nếu có *@
                            @if (coSaoNua)
                            {
                                <div class="bi-star-half"></div>
                            }

                            @* Hiển thị sao rỗng *@
                            @for (int i = 0; i < soSaoRong; i++)
                            {
                                <div class="bi-star"></div>
                            }

                            @* Hiển thị điểm số và số lượng đánh giá *@
                            @if (soLuongDanhGia > 0)
                            {
                                <span class="ms-2 text-muted" style="font-size: 0.85rem;">
                                    (@diemTrungBinh.ToString("0.0")/5 - @soLuongDanhGia đánh giá)
                                </span>
                            }
                            else
                            {
                                <span class="ms-2 text-muted" style="font-size: 0.85rem;">
                                    (Chưa có đánh giá)
                                </span>
                            }
                        </div>

                        <!-- Product price -->
                        <div>
                            @if (item.GiaGoc.HasValue && item.GiaGoc > item.GiaBan)
                            {
                                <span class="text-muted text-decoration-line-through price-original">@string.Format("{0:N0}₫", item.GiaGoc)</span>
                            }
                            <span class="price-sale">@string.Format("{0:N0}₫", item.GiaBan)</span>
                        </div>
                    </div>
                </div>

                <!-- Product actions -->
                <div class="card-footer p-4 pt-0 border-top-0 bg-transparent">
                    <div class="d-flex justify-content-between align-items-center">
                        <!-- Nút xem chi tiết (Đã chỉnh lại asp-controller thành Customers) -->
                        <a asp-controller="Customers"
                           asp-action="Details"
                           asp-route-id="@item.MaMh"
                           class="btn btn-outline-secondary btn-sm flex-grow-1 me-2">
                            <i class="bi bi-eye"></i> Chi tiết
                        </a>

                        <!-- Nút Mua hàng (Trỏ đến AddToCart - sẽ kiểm tra đăng nhập) -->
                        <a asp-controller="Customers"
                           asp-action="AddToCart"
                           asp-route-id="@item.MaMh"
                           class="btn btn-success btn-sm flex-grow-1 text-white fw-bold">
                            <i class="bi bi-bag-plus-fill"></i> Mua hàng
                        </a>
                    </div>
                </div>
            </div>
        </div>
    }
</div>